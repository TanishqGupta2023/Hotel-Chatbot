<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Hotel Chatbot</title>
<style>
  body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  margin: 0;
  padding: 0;
  background-color: #fff9f0; /* Soft background */
}

.chat-container {
  width: 700px;
  height: 720px;
  margin: 50px auto;
  background-color: #fff3e0; /* lighter elegant shade */
  border-radius: 16px;
  box-shadow: 0 12px 30px rgba(0, 0, 0, 0.08);
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.chat-header {
  background: linear-gradient(to right, #f4a261, #e76f51); /* Elegant warm gradient */
  color: white;
  padding: 22px;
  text-align: center;
  font-size: 28px;
  font-weight: bold;
  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
}

#chatBox {
  padding: 24px;
  flex-grow: 1;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  background-color: #fffaf3; /* chat background */
}

.user-message,
.bot-message {
  padding: 14px 18px;
  margin: 10px 0;
  border-radius: 12px;
  max-width: 80%;
  font-size: 15px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}

.user-message {
  background-color: #d4f7c5;
  align-self: flex-end;
  color: #1e4620;
}

.bot-message {
  background-color: #f6eee3;
  align-self: flex-start;
  color: #333;
}

.timestamp {
  font-size: 11px;
  color: #777;
  margin-top: 4px;
  text-align: right;
}

.chat-input {
  display: flex;
  padding: 18px;
  border-top: 1px solid #ddd;
  background-color: #fff8f0;
}

.chat-input input {
  flex-grow: 1;
  padding: 12px 16px;
  border: 1px solid #ccc;
  border-radius: 10px;
  font-size: 16px;
  background-color: 	#f1f0ed;
  transition: 0.3s border;
}

.chat-input input:focus {
  outline: none;
  border-color: #f4a261;
}

.chat-input button {
  margin-left: 12px;
  padding: 12px 18px;
  background-color: #f4a261;
  color: white;
  border: none;
  border-radius: 10px;
  font-size: 16px;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

.chat-input button:hover {
  background-color: #e76f51;
}

.loading-dots {
  font-size: 20px;
  color: #888;
  display: inline-block;
}

.loading-dots span {
  animation: blink 1.4s infinite both;
  margin-right: 2px;
}

.loading-dots span:nth-child(2) {
  animation-delay: 0.2s;
}

.loading-dots span:nth-child(3) {
  animation-delay: 0.4s;
}

@keyframes blink {
  0%, 80%, 100% { opacity: 0; }
  40% { opacity: 1; }
}
</style>

</head>
<body>
  <div class="chat-container">
    <div class="chat-header">Hotel Chatbot</div>

<div class="chat-box" id="chatBox">
  {% if chat_history %}
    {% for pair in chat_history %}
      {% if pair.user %}
        <div class="user-message">
          {{ pair.user }}
          {% if pair.time %}
            <div class="timestamp">{{ pair.time }}</div>
          {% endif %}
        </div>
      {% endif %}

      {% if pair.bot %}
        <div class="bot-message">
          {{ pair.bot }}
          {% if pair.bot_time %}
            <div class="timestamp">{{ pair.bot_time }}</div>
          {% endif %}
        </div>
      {% endif %}
    {% endfor %}
  {% endif %}
</div>

    <form id="chatForm" method="POST" class="chat-input">
      {% csrf_token %}
      <input type="text" name="message" id="messageInput" placeholder="Type your message or use voice..." required />
      <button type="submit">Send</button>
      <button type="button" onclick="startVoice()">ðŸŽ¤</button>
    </form>
  </div>

  <script>
    function startVoice() {
      const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
      recognition.lang = 'en-US';
      recognition.interimResults = false;

      recognition.start();

      recognition.onresult = function(event) {
        const transcript = event.results[0][0].transcript;
        document.getElementById('messageInput').value = transcript;
        document.getElementById('chatForm').submit();
      };

      recognition.onerror = function(event) {
        alert('Voice recognition error: ' + event.error);
      };
    }

    function speakBotMessage(text) {
      if ('speechSynthesis' in window) {
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'en-US';
        speechSynthesis.speak(utterance);
      }
    }

    document.addEventListener("DOMContentLoaded", function () {
      const chatBox = document.getElementById("chatBox");
      const botMessages = document.querySelectorAll(".bot-message");
      if (botMessages.length > 0) {
        const lastBotMessage = botMessages[botMessages.length - 1];
const botText = Array.from(lastBotMessage.childNodes)
  .filter(node => node.nodeType === Node.TEXT_NODE)
  .map(node => node.textContent.trim())
  .join(" ");
speakBotMessage(botText);

      }
      chatBox.scrollTop = chatBox.scrollHeight;
    });

    document.getElementById("chatForm").addEventListener("submit", function (e) {
      e.preventDefault();

      const input = document.getElementById("messageInput");
      const message = input.value.trim();
      if (!message) return;

      const chatBox = document.getElementById("chatBox");

      
      const userDiv = document.createElement("div");
      userDiv.className = "user-message";
      userDiv.innerText = message;

      const timestamp = document.createElement("div");
      timestamp.className = "timestamp";
      timestamp.innerText = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
      userDiv.appendChild(timestamp);

      chatBox.appendChild(userDiv);


      const loading = document.createElement("div");
      loading.className = "bot-message";
      loading.innerHTML = `
        <div class="loading-dots">
          <span>.</span><span>.</span><span>.</span>
        </div>
      `;
      chatBox.appendChild(loading);

      chatBox.scrollTop = chatBox.scrollHeight;

      setTimeout(() => {
        this.submit();
      }, 1000);
    });
  </script>
</body>
</html> 